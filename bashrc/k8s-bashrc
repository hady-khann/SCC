#!/bin/bash

tee /etc/scc/.k8s-bashrc > /dev/null << 'EOF'
#!/bin/bash

# =====================
# Minikube (m)
# =====================

# base m <args>
m() {
  if ! command -v minikube &> /dev/null; then
    echo "Error: minikube is not installed or not in PATH" >&2
    return 1
  fi

  if [ $# -eq 0 ]; then
    echo "Usage: m <minikube-subcommand> [args...]" >&2
    echo "Example: m addons list | m start --driver=docker"
    return 1
  fi

  minikube "$@"
}

# Core
m-strt() { minikube start; }
m-stp() { minikube stop; }
m-del() { minikube delete; }
m-stat() { minikube status; }
m-ip() { minikube ip; }
m-dash() { minikube dashboard; }
m-ssh() { minikube ssh; }
m-mnt() { minikube mount "$@"; }

# Config
m-cfg() { minikube config view; }
m-cfg-set() { minikube config set "$1" "$2"; }
m-cfg-unset() { minikube config unset "$1"; }

# Addons
m-add-ls() { minikube addons list; }
m-add-en() { minikube addons enable "$1"; }
m-add-dis() { minikube addons disable "$1"; }

# Services
m-svc-ls() { minikube service list; }
m-svc-url() { minikube service "$1" --url; }
m-svc-open() { minikube service "$1"; }

# Logs
m-lg() { minikube logs; }
m-lgf() { minikube logs -f; }
m-lgp() { minikube logs --problems; }

# Advanced
m-pus() { minikube pause; }
m-unpus() { minikube unpause; }
m-tun() { minikube tunnel; }
m-prof() { minikube profile "$1"; }
m-cp() { minikube cp "$1" "$2"; }
m-img-load() { minikube image load "$1"; }
m-img-rm() { minikube image rm "$1"; }
m-img-ls() { minikube image ls; }

# =====================
# Kubectl (k)
# =====================

# base m <args>
k() {
  if ! command -v kubectl &> /dev/null; then
    echo "Error: kubectl is not installed or not in PATH" >&2
    return 1
  fi

  if [ $# -eq 0 ]; then
    echo "Usage: k <kubectl-subcommand> [args...]" >&2
    echo "Example: k get pods | k apply -f file.yaml"
    return 1
  fi

  kubectl "$@"
}

# Core
k-cfg() { kubectl config "$@"; }
k-ci() { kubectl cluster-info; }
k-ver() { kubectl version; }
k-api-res() { kubectl api-resources; }
k-api-ver() { kubectl api-versions; }

# Context
k-ctx() { kubectl config current-context; }
k-ctx-ls() { kubectl config get-contexts; }
k-ctx-use() { kubectl config use-context "$1"; }
k-ctx-set() { kubectl config set-context "$1"; }
k-ctx-ns() { kubectl config set-context --current --namespace="$1"; }
k-ns-cur() { kubectl config view --minify --output 'jsonpath={..namespace}'; echo; }

# CRUD
k-g() { kubectl get "$@"; }
k-d() { kubectl describe "$@"; }
k-c() { kubectl create "$@"; }
k-a() { kubectl apply "$@"; }
k-del() { kubectl delete "$@"; }
k-e() { kubectl edit "$@"; }
k-ex() { kubectl explain "$@"; }

# Resources
k-p() { kubectl get pods "$@"; }
k-pw() { kubectl get pods -w; }
k-pwide() { kubectl get pods -o wide; }
k-pall() { kubectl get pods --all-namespaces; }
k-no() { kubectl get nodes; }
k-nowide() { kubectl get nodes -o wide; }
k-dep() { kubectl get deployments; }
k-rs() { kubectl get replicasets; }
k-svc() { kubectl get services; }
k-ing() { kubectl get ingress; }
k-cm() { kubectl get configmaps; }
k-sec() { kubectl get secrets; }
k-pv() { kubectl get pv; }
k-pvc() { kubectl get pvc; }
k-sc() { kubectl get sc; }
k-sa() { kubectl get serviceaccounts; }
k-crd() { kubectl get crd; }
k-j() { kubectl get jobs; }
k-cj() { kubectl get cronjobs; }

# Logs
k-lg() { kubectl logs "$@"; }
k-lgf() { kubectl logs -f "$@"; }
k-lgp() { kubectl logs -p "$@"; }
k-lga() { kubectl logs --all-containers "$@"; }
k-top-p() { kubectl top pod; }
k-top-n() { kubectl top node; }
k-ev() { kubectl get events; }
k-evw() { kubectl get events -w; }
k-eva() { kubectl get events --all-namespaces; }
k-dbg() { kubectl debug "$@"; }

# Networking
k-pf() { kubectl port-forward "$@"; }
k-px() { kubectl proxy; }

# Exec
k-ex() { kubectl exec -it "$@"; }
k-exb() { kubectl exec -it "$1" -- bash; }
k-exs() { kubectl exec -it "$1" -- sh; }
k-att() { kubectl attach -it "$@"; }
k-run() { kubectl run "$@"; }

# Management
k-scale() { kubectl scale "$@"; }
k-auto() { kubectl autoscale "$@"; }
k-roll() { kubectl rollout "$@"; }
k-roll-stat() { kubectl rollout status "$@"; }
k-roll-hist() { kubectl rollout history "$@"; }
k-roll-undo() { kubectl rollout undo "$@"; }
k-cord() { kubectl cordon "$@"; }
k-uncord() { kubectl uncordon "$@"; }
k-drn() { kubectl drain "$@"; }
k-tnt() { kubectl taint "$@"; }

# Output
k-gy() { kubectl get "$@" -o yaml; }
k-gj() { kubectl get "$@" -o json; }
k-diff() { kubectl diff -f "$@"; }
k-exp() { kubectl get "$@" -o yaml --export; }

# Updates
k-patch() { kubectl patch "$@"; }
k-rep() { kubectl replace "$@"; }
k-lbl() { kubectl label "$@"; }
k-ann() { kubectl annotate "$@"; }

# Advanced
k-auth() { kubectl auth "$@"; }
k-cert() { kubectl certificate "$@"; }
k-top() { kubectl top "$@"; }
k-wait() { kubectl wait "$@"; }

# Plugins
k-plg() { kubectl plugin "$@"; }

# Custom
k-gc() { kubectl get "$1" -o custom-columns="$2"; }
k-gw() { kubectl get "$1" -o wide; }
k-gj() { kubectl get "$1" -o jsonpath="$2"; }

# Watch
k-w() { watch -n 1 "kubectl get $@"; }
k-wp() { watch -n 1 "kubectl get pods $@"; }
k-wn() { watch -n 1 "kubectl get nodes $@"; }

# =====================
# Combined
# =====================

# Minikube
m-up-all() { m-up; m-stat; k-ci; }
m-down-all() { m-down; m-del; }

# Resources
k-ga() { kubectl get all --all-namespaces; }
k-wa() { watch -n 1 "kubectl get all,ing,pv,pvc,cm,sec,sa"; }

# Pods
k-pi() {
  kubectl get pods -o wide
  kubectl get pods -o custom-columns="NAME:.metadata.name,STATUS:.status.phase,NODE:.spec.nodeName,IP:.status.podIP"
}

# Nodes
k-ni() {
  kubectl get nodes -o wide
  kubectl get nodes -o custom-columns="NAME:.metadata.name,STATUS:.status.conditions[?(@.type=='Ready')].status,ROLES:.metadata.labels.kubernetes\.io/role,INTERNAL-IP:.status.addresses[?(@.type=='InternalIP')].address,KERNEL:.status.nodeInfo.kernelVersion,OS:.status.nodeInfo.osImage"
}

# Logs
k-lgd() { kubectl logs deployment/"$1" --all-containers --follow; }

# Counts
k-cnt() {
  kubectl get pods --all-namespaces -o json | jq -r '.items | group-by(.metadata.namespace) | map({namespace: .[0].metadata.namespace, count: length}) | sort-by(.count) | reverse[] | "\(.namespace): \(.count)"'
}

# Images
k-imgs() {
  kubectl get pods --all-namespaces -o jsonpath="{.items[*].spec.containers[*].image}" | tr -s '[[:space:]]' '\n' | sort | uniq -c | sort -nr
}

# Bulk ops
k-gar() { kubectl get "$1" --all-namespaces; }
k-dar() { kubectl describe "$1" --all-namespaces; }
k-delall() { kubectl delete "$1" --all; }
k-delallns() { kubectl delete "$1" --all --all-namespaces; }

# Networking
k-pi() { kubectl get pods -o custom-columns="NAME:.metadata.name,NODE:.spec.nodeName,IP:.status.podIP"; }
k-ep() { kubectl get endpoints; }

# Storage
k-pvcs() { kubectl get pvc -o custom-columns="NAME:.metadata.name,STATUS:.status.phase,VOLUME:.spec.volumeName,STORAGECLASS:.spec.storageClassName"; }
k-pvs() { kubectl get pv -o custom-columns="NAME:.metadata.name,STATUS:.status.phase,CLAIM:.spec.claimRef.name,STORAGECLASS:.spec.storageClassName"; }

# Metadata
k-gl() { kubectl get all --show-labels; }

# Resources
k-pr() {
  kubectl get pods -o custom-columns="NAME:.metadata.name,CPU-REQ:.spec.containers[*].resources.requests.cpu,MEM-REQ:.spec.containers[*].resources.requests.memory,CPU-LIM:.spec.containers[*].resources.limits.cpu,MEM-LIM:.spec.containers[*].resources.limits.memory"
}

# Nodes
k-nr() {
  kubectl get nodes -o custom-columns="NAME:.metadata.name,CPU-CAP:.status.capacity.cpu,CPU-ALLOC:.status.allocatable.cpu,MEM-CAP:.status.capacity.memory,MEM-ALLOC:.status.allocatable.memory"
}

# Pod status
k-ps() {
  kubectl get pods -o custom-columns="NAME:.metadata.name,STATUS:.status.phase,READY:.status.containerStatuses[*].ready"
}

# Services
k-ss() { kubectl get svc -o custom-columns="NAME:.metadata.name,SELECTOR:.spec.selector"; }

# Ingress
k-ih() { kubectl get ingress -o custom-columns="NAME:.metadata.name,HOSTS:.spec.rules[*].host"; }

# ConfigMaps
k-ck() { kubectl get cm -o custom-columns="NAME:.metadata.name,KEYS:.data"; }

# Secrets
k-sk() { kubectl get secrets -o custom-columns="NAME:.metadata.name,TYPE:.type,KEYS:.data"; }

# Security
k-psec() {
  kubectl get pods -o custom-columns="NAME:.metadata.name,SERVICE-ACCOUNT:.spec.serviceAccountName,SECURITY-CONTEXT:.spec.securityContext"
}


# =====================
# Help Functions
# =====================


k-help() {
  echo -e "\n\033[1;34mKUBECTL SHORTCUTS (k-*)\033[0m"
  echo -e "\033[1;36mCore Commands:\033[0m"
  echo "  k <kubectl-subcommand> [args...]"
  echo "    ↳ Shortcut for 'kubectl'"
  echo "    ℹ Examples:"
  echo "      k get pods"
  echo "      k apply -f deploy.yaml"
  echo "      k logs my-pod"
  echo "      k describe svc my-service"
  echo "      k config get-contexts"

  echo -e "\n\033[1;36mCluster Info:\033[0m"
  echo "  k-cfg       - Manage kubeconfig"
  echo "  k-ci        - Show cluster info"
  echo "  k-ver       - Show version"
  echo "  k-api       - List API resources"
  echo "  k-apis      - List API versions"

  echo -e "\n\033[1;36mContext Management:\033[0m"
  echo "  k-ctx       - Show current context"
  echo "  k-ctx-ls    - List all contexts"
  echo "  k-ctx-use   - Switch context"
  echo "  k-ctx-set   - Set context properties"
  echo "  k-ns        - Set namespace"
  echo "  k-ns-cur    - Show current namespace"

  echo -e "\n\033[1;36mCRUD Operations:\033[0m"
  echo "  k-g         - Get resources"
  echo "  k-d         - Describe resources"
  echo "  k-c         - Create resources"
  echo "  k-a         - Apply manifest"
  echo "  k-del       - Delete resources"
  echo "  k-e         - Edit resource"
  echo "  k-explain   - Explain resource"

  echo -e "\n\033[1;36mQuick Access:\033[0m"
  echo "  k-p         - Get pods"
  echo "  k-pw        - Watch pods"
  echo "  k-pwide     - Get pods (wide)"
  echo "  k-pall      - All pods (all namespaces)"
  echo "  k-no        - Get nodes"
  echo "  k-nowide    - Nodes (wide)"
  echo "  k-dep       - Get deployments"
  echo "  k-rs        - Get replicasets"
  echo "  k-svc       - Get services"
  echo "  k-ing       - Get ingress"
  echo "  k-cm        - Get configmaps"
  echo "  k-sec       - Get secrets"
  echo "  k-pv        - Get persistent volumes"
  echo "  k-pvc       - Get volume claims"
  echo "  k-sc        - Get storage classes"
  echo "  k-sa        - Get service accounts"
  echo "  k-crd       - Get CRDs"
  echo "  k-j         - Get jobs"
  echo "  k-cj        - Get cronjobs"

  echo -e "\n\033[1;36mLogs & Monitoring:\033[0m"
  echo "  k-lg        - Show logs"
  echo "  k-lgf       - Follow logs"
  echo "  k-lgp       - Previous logs"
  echo "  k-lga       - All container logs"
  echo "  k-top-p     - Pod metrics"
  echo "  k-top-n     - Node metrics"
  echo "  k-ev        - Events"
  echo "  k-evw       - Watch events"
  echo "  k-eva       - Events (all namespaces)"
  echo "  k-dbg       - Debug pod"

  echo -e "\n\033[1;36mNetworking:\033[0m"
  echo "  k-pf        - Port forward"
  echo "  k-px        - Start proxy"

  echo -e "\n\033[1;36mExecution:\033[0m"
  echo "  k-ex        - Exec in pod"
  echo "  k-exb       - Bash in pod"
  echo "  k-exs       - Sh in pod"
  echo "  k-att       - Attach to container"
  echo "  k-run       - Run pod"

  echo -e "\n\033[1;36mRollouts & Scale:\033[0m"
  echo "  k-scale     - Scale deployment"
  echo "  k-auto      - Autoscaler"
  echo "  k-roll      - Rollout"
  echo "  k-roll-stat - Rollout status"
  echo "  k-roll-hist - Rollout history"
  echo "  k-roll-undo - Rollout undo"
  echo "  k-cord      - Cordon node"
  echo "  k-uncord    - Uncordon node"
  echo "  k-drn       - Drain node"
  echo "  k-tnt       - Taint node"

  echo -e "\n\033[1;36mOutput:\033[0m"
  echo "  k-gy        - YAML output"
  echo "  k-gj        - JSON output"
  echo "  k-diff      - Show diff"
  echo "  k-exp       - Export resource"

  echo -e "\n\033[1;36mAdvanced Views:\033[0m"
  echo "  k-ga        - All resources (all ns)"
  echo "  k-wa        - Watch all"
  echo "  k-pi        - Pod IPs"
  echo "  k-ni        - Node info"
  echo "  k-lgd       - Logs by deployment"
  echo "  k-cnt       - Pod count by ns"
  echo "  k-imgs      - Container images"
  echo "  k-gar       - Get all of resource"
  echo "  k-dar       - Describe all of resource"
  echo "  k-delall    - Delete all of resource"
  echo "  k-delallns  - Delete all in all ns"
  echo "  k-ep        - Endpoints"
  echo "  k-gl        - Get by label"
  echo "  k-pr        - Pod resource usage"
  echo "  k-nr        - Node resources"
  echo "  k-ps        - Pod status"
  echo "  k-ss        - Service selectors"
  echo "  k-ih        - Ingress hosts"
  echo "  k-ck        - ConfigMap keys"
  echo "  k-sk        - Secret keys"
  echo "  k-psec      - Pod security context"

  echo -e "\n\033[1;36mWatchers:\033[0m"
  echo "  k-w         - Watch resource"
  echo "  k-wp        - Watch pods"
  echo "  k-wn        - Watch nodes"
}


m-help() {
  echo -e "\n\033[1;34mMINIKUBE SHORTCUTS (m-*)\033[0m"
  echo -e "\033[1;36mCore Commands:\033[0m"
  echo "  m <minikube-subcommand> [args...]"
  echo "    ↳ Shortcut for 'minikube'"
  echo "    ℹ Examples:"
  echo "      m start --driver=docker"
  echo "      m status"
  echo "      m addons list"
  echo "      m addons enable ingress"
  echo "      m delete --purge"

  echo -e "\n\033[1;36mCluster Lifecycle:\033[0m"
  echo "  m-up       - Start minikube cluster"
  echo "  m-down     - Stop minikube cluster"
  echo "  m-del      - Delete minikube cluster"
  echo "  m-stat     - Show cluster status"
  echo "  m-ip       - Get cluster IP address"
  echo "  m-dash     - Open dashboard"
  echo "  m-ssh      - SSH into minikube VM"
  echo "  m-mnt      - Mount host directory to VM"

  echo -e "\n\033[1;36mConfiguration:\033[0m"
  echo "  m-cfg       - View current config"
  echo "  m-cfg-set   - Set config property"
  echo "  m-cfg-unset - Unset config property"

  echo -e "\n\033[1;36mAddons:\033[0m"
  echo "  m-add-ls   - List available addons"
  echo "  m-add-on   - Enable an addon"
  echo "  m-add-off  - Disable an addon"

  echo -e "\n\033[1;36mServices:\033[0m"
  echo "  m-svc-ls   - List services"
  echo "  m-svc-url  - Get service URL"
  echo "  m-svc-open - Open service in browser"

  echo -e "\n\033[1;36mLogs:\033[0m"
  echo "  m-lg       - Show logs"
  echo "  m-lgf      - Follow logs"
  echo "  m-lgp      - Show problem logs"

  echo -e "\n\033[1;36mAdvanced:\033[0m"
  echo "  m-pause    - Pause cluster"
  echo "  m-unpause  - Unpause cluster"
  echo "  m-tun      - Create network tunnel"
  echo "  m-prof     - Set active profile"
  echo "  m-cp       - Copy files to/from VM"
  echo "  m-img-load - Load image into cluster"
  echo "  m-img-rm   - Remove image from cluster"
  echo "  m-img-ls   - List loaded images"

  echo -e "\n\033[1;36mCombined:\033[0m"
  echo "  m-up-all   - Start cluster and show status"
  echo "  m-down-all - Stop and delete cluster"
}


EOF
